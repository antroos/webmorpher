# Инструкция по выпуску WebMorpher

Это подробное руководство по сборке, выпуску и распространению приложения WebMorpher. Следуйте этим шагам для гарантированного воспроизведения процесса сборки.

## 1. Подготовка среды разработки

### Требования
- macOS 10.13 или новее
- Python 3.11+ 
- Git
- Chrome/Chromium (установленный в системе)

### Настройка среды
```bash
# Клонирование репозитория
git clone https://github.com/yourusername/WebMorpher.git
cd WebMorpher

# Создание и активация виртуального окружения
python3.11 -m venv env311
source env311/bin/activate

# Установка зависимостей
pip install -r requirements.txt
```

## 2. Процесс сборки

### Сборка приложения и DMG-пакета
```bash
# Запуск скрипта сборки (создаёт .app и .dmg)
bash create_app_bundle.sh
```

> **Важно:** Скрипт сборки автоматически очистит API ключ в конфигурационном файле (если он существует) перед созданием DMG-пакета.

### Что происходит при сборке:
1. Создаётся структура директорий для WebMorpher.app
2. Генерируется файл Info.plist с метаданными приложения
3. Создается запускающий скрипт в директории MacOS
4. Устанавливается виртуальное окружение Python внутри приложения
5. Копируются все необходимые файлы ресурсов
6. Создаётся DMG-пакет для распространения (размер ~300 МБ)

## 3. Структура приложения

```
WebMorpher.app/
├── Contents/
│   ├── Info.plist             # Информация о приложении
│   ├── MacOS/
│   │   └── webmorpher         # Запускающий скрипт
│   └── Resources/
│       ├── app.py             # Основной код приложения
│       ├── icon.icns          # Иконка приложения
│       ├── python_env/        # Виртуальное окружение Python
│       ├── requirements.txt   # Список зависимостей
│       └── README.md          # Документация
```

## 4. Особенности работы приложения

### Файл конфигурации
WebMorpher сохраняет настройки в `~/.webmorpher_config.json`. Этот файл содержит:
- API ключ пользователя (при условии что пользователь его ввёл)
- Сохранённые программы автоматизации

### Профиль браузера
- По умолчанию приложение использует существующий профиль Chrome пользователя
- Путь к профилю определяется автоматически в зависимости от ОС
- На macOS: `~/Library/Application Support/Google/Chrome`
- Эта функция позволяет пользователю сохранять пароли, cookies и историю браузера

### API ключ
- При первом запуске пользователю необходимо ввести свой API ключ OpenAI
- Ключ сохраняется локально и используется для запросов к API
- Для сброса ключа можно использовать параметр `--reset-api-key`

## 5. Тестирование сборки

Перед выпуском обязательно проверьте:
1. Установку из DMG-файла (перетаскивание в Applications)
2. Запуск приложения и ввод API ключа
3. Создание и запуск программы автоматизации
4. Работу с профилем пользователя Chrome (сохранение паролей и cookies)
5. Запуск в режиме отладки

## 6. Решение проблем

### Проблема: Приложение не запускается
- Проверьте, что установлен Python 3.11+ на компьютере, где собирается приложение
- Убедитесь, что все зависимости установлены (см. requirements.txt)

### Проблема: Ошибки при работе с браузером
- Убедитесь, что Chrome/Chromium установлен в системе
- Проверьте наличие профиля Chrome в стандартной директории

### Проблема: Размер DMG-файла отличается от ожидаемого
- Нормальный размер DMG-файла: ~300 МБ
- Если размер значительно отличается, проверьте содержимое Resources/python_env

## 7. Дополнительная информация

### Очистка перед новой сборкой
```bash
# Удаление предыдущих сборок
rm -rf WebMorpher.app WebMorpher.dmg

# Сброс API ключа
python app.py --reset-api-key
```

### Команда для отдельного сброса API ключа
```bash
# Запуск с параметром сброса ключа
./WebMorpher.app/Contents/MacOS/webmorpher --reset-api-key
``` 