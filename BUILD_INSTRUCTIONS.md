# Инструкция по сборке WebMorpher

## Описание приложения

WebMorpher — это macOS-приложение, которое позволяет пользователям создавать и запускать программы для автоматизации браузера с помощью библиотеки browser-use. Приложение позволяет управлять браузером Chrome, используя OpenAI API для выполнения задач в web-интерфейсах.

## Требования

- macOS 10.13 или более новая версия
- Python 3.11+ для разработки и сборки
- Chrome или Chromium, установленный на компьютере
- Ключ API OpenAI (GPT-4o)

## Структура проекта

```
WebMorpher/
├── app.py                  # Основной код приложения
├── create_app_bundle.sh    # Скрипт для создания .app бандла и DMG-пакета
├── icon.icns               # Иконка приложения (для macOS)
├── requirements.txt        # Зависимости Python
├── setup.py                # Настройки сборки (для py2app)
└── README.md               # Документация для пользователей
```

## Ключевые компоненты

1. **app.py** - Основной файл приложения, содержащий:
   - Интерфейс пользователя (PyQt5)
   - Логику запуска браузера
   - Работу с API OpenAI через библиотеку browser-use
   - Управление профилями пользователей браузера

2. **create_app_bundle.sh** - Скрипт для создания независимого приложения:
   - Создаёт структуру .app бандла
   - Настраивает виртуальное окружение Python 3.11
   - Устанавливает зависимости
   - Создаёт DMG-пакет для распространения

## Ключевые особенности

1. **Использование профиля пользователя** - Приложение может использовать существующий профиль Chrome пользователя:
   - Доступ к сохраненным паролям, cookies и истории
   - Опция включена по умолчанию
   - Определяет местонахождение профиля Chrome в зависимости от ОС

2. **Режим отладки** - Возможность запуска Chrome в отладочном режиме:
   - Использование удаленного порта для отладки (9222)
   - Сохранение логов в файл

3. **Настройки приватности** - API ключ сохраняется локально:
   - Хранится в `~/.webmorpher_config.json`
   - Не передается никуда, кроме OpenAI API

## Процесс сборки

### 1. Подготовка виртуального окружения

```bash
# Создание виртуального окружения с Python 3.11
python3.11 -m venv env311
source env311/bin/activate

# Установка зависимостей
pip install -r requirements.txt
```

### 2. Запуск для разработки

```bash
python app.py
```

### 3. Сборка приложения

```bash
# Сборка приложения и создание DMG-пакета
bash create_app_bundle.sh
```

## Скрипт create_app_bundle.sh

Этот скрипт автоматизирует следующие шаги:

1. Создание структуры директорий для .app бандла:
   ```
   WebMorpher.app/
   ├── Contents/
       ├── Info.plist       # Информация о приложении
       ├── MacOS/           # Исполняемые файлы
       └── Resources/       # Ресурсы и код Python
   ```

2. Создание запускающего скрипта, который:
   - Настраивает переменные окружения
   - Активирует виртуальное окружение Python
   - Запускает app.py

3. Копирование всех ресурсов и кода в бандл

4. Создание виртуального окружения Python внутри .app бандла

5. Создание DMG-пакета для распространения при помощи утилиты hdiutil

## Решение проблем при сборке

### Проблемы с импортом модулей

Если во время запуска приложения возникают ошибки отсутствующих модулей:
1. Убедитесь, что все зависимости добавлены в requirements.txt
2. Проверьте, что все модули импортируются корректно в app.py
3. При использовании py2app обновите секцию 'packages' в setup.py

### Проблемы с запуском на других системах

1. Проверьте путь к Python в скрипте запуска
2. Убедитесь, что приложение не использует абсолютные пути для доступа к ресурсам

## Использование приложения

После установки:
1. Запустите WebMorpher.app
2. Введите ваш API ключ OpenAI
3. Создайте новую программу с кодом задачи для browser-use
4. Запустите программу, чтобы управлять браузером

## Важные заметки

- В режиме разработки приложение использует локальный Python и зависимости из virtualenv
- В скомпилированном приложении используется его собственное окружение Python в Resources/python_env
- Приложение определяет свой режим работы (разработка/скомпилировано) проверкой sys.frozen 